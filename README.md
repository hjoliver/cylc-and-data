# Cylc Workflows &amp; Data

A simple example to illustrate the relationship between Cylc workflows and the
data they process.

## Background

Cylc is a *dependency-driven workflow manager*: it takes a bunch of arbitrary
applications (commands, scripts, executables) and makes them cooperate in a
workflow defined by a dependency graph. In the graph, nodes represent tasks
(which know how to run their applications), and edges are (mostly) status-
and message-based *triggers*.

```cylc
# Some example Cylc dependency triggers.
foo => bar  # run bar if foo succeeds (i.e., finishes with success status)
foo:fail => bar  # run bar if foo fails (i.e., finishes with error status)
foo:file1 => bar  # run bar if foo sends a message registered as "file1"
```

These *task dependency* relationships often implicitly reflect *data dependence*
(which works because tasks should, for instance, only succeed if they
successfully load/write their expected input/output data) *but Cylc itself
does not "know" about the data* - it just provides a shared workspace for
tasks to interact via the filesystem if they need to.

(This is for flexibility and efficiency: Cylc does not make any assumptions
about nor impose any constraints on the data being processed, and how or
whether to move it around. If your workflow is distributed and you need to
move data between platforms, just add tasks to do that by any means available.)

So: if task B needs to read a file generated by task A, then the workflow
must configure the corresponding applications (via their respective task
definitions within the workflow) to use the same shared path for that
file. How to do this depends mostly on the configuration requirements of
the applications.

## A minimal example (runnable)

The workflow source directory `cylc-src/one`:

```bash
$ tree cylc-src/
cylc-src/
└── one  # workflow "one" source directory
    ├── bin
    │   ├── a.sh  # application 1
    │   └── b.sh  # application 2
    └── flow.cylc  # workflow config
```

The dependency graph has only two tasks, `a` and `b`:

```cylc
# flow.cylc
R1 = "a => b"  # trigger a, then trigger b if a succeeds
```

Task `a` runs the application `bin/a.sh`, whose output path is configured
by a command line option.

Task `b` runs the application `bin/b.sh`, whose I/O paths are configured by
environment variables, and which can process the kind of data generated by `a`.

The workflow defines a shared file path and configures `a` to use it for
output, and `b` to use it as input:

```cylc
[scheduling]
    [[graph]]
        R1 = "a => b"  # trigger a, then trigger b if a succeeds
[runtime]
    [[root]]  # (inherited by all tasks)
        [[[environment]]]
            # Location of intermediate file used by tasks a and b.
            IDATA = "${CYLC_WORKFLOW_SHARE_DIR}/idata"
    [[a]]
        # run "a.sh" (which gets output location from the CLI)
        script = "a.sh --output=$IDATA"
    [[b]]
        # run "b.sh" (whose I/O is configured by environment variables)
        script = "b.sh"
        [[[environment]]]
            B_INPUT = "$IDATA"
            B_OUTPUT = "${CYLC_WORKFLOW_SHARE_DIR}/result"
```

**NOTE:** there are no Cylc keywords that point to or describe these files.
Shared file paths are communicated to an application by (e.g.) taking
user-defined environment variables from the task definition and writing
them verbatim to the job script that runs the application. Cylc knows that
these are environment variables, but not what they represent.

### Running the example

```console
# Go to the workflow source directory
$ cd cylc-src/one

# validate, install, and play the workflow
$ cylc vip --no-detach .
...
```

### Viewing the output

```console
# view the shared workspace for the run
$ tree ~/cylc-run/one/runN/share
/home/oliverh/cylc-run/one/runN/share
├── idata
└── result

# view task b's job.out log
$ cylc cat-log one//1/b
Workflow : one/run6
Job : 1/b/01 (try 1)
User@Host: oliverh@NIWA-1022450
Processing data
  from "/home/oliverh/cylc-run/one/run6/share/idata"
  to "/home/oliverh/cylc-run/one/run6/share/result"
Done
2025-03-20T02:17:25Z INFO - started
2025-03-20T02:17:25Z INFO - succeeded

# inspect the job log directory
$ tree ~/cylc-run/one/runN/log/job
/home/oliverh/cylc-run/one/runN/log/job
└── 1
    ├── a
    │   ├── 01
    │   │   ├── job
    │   │   ├── job-activity.log
    │   │   ├── job.err
    │   │   ├── job.out
    │   │   └── job.status
    │   └── NN -> 01
    └── b
        ├── 01
        │   ├── job
        │   ├── job-activity.log
        │   ├── job.err
        │   ├── job.out
        │   └── job.status
        └── NN -> 01

```
