# Cylc and Data

A simple example to illustrate the relationship between Cylc workflows and the
data they manipulate.

## Background

Cylc is a *dependency-driven workflow manager*: it takes a bunch of *tasks*
(which can represent arbitrary applications - commands, scripts, executables)
and makes them run according to a task dependency graph. The graph edges
represent task status- and message-based triggers (plus clock and external
triggers).

```cylc
# Some example Cylc dependency graph triggers.
foo => bar  # run bar if foo succeeds (i.e., finishes with success status)
foo:fail => bar  # run bar if foo fails (i.e., finishes with error status)
foo:file1 => bar  # run bar if foo sends a message registered as "file1"
```

Cylc itself does not "know" about the data processed by your tasks, it just
provides a shared workspace for tasks to communicate via the filesystem.

If the workflow is distributed over platforms that do not all see the same
filesystem, just add tasks to move files by any means available, as needed.

So: if task B needs to read a file generated by task A, then the workflow
must configure the corresponding applications (via their respective task
definitions) to use the same shared file path. How to do this depends
entirely on the application - how are their file locations configured?).

## A minimal example (runnable)

The workflow source directory `cylc-src/one`:

```bash
$ tree cylc-src/
cylc-src/
└── one  # workflow "one" source directory
    ├── bin
    │   ├── a.sh  # application 1
    │   └── b.sh  # application 2
    └── flow.cylc  # workflow config
```

The dependency graph has only two tasks, `a` and `b`:

```cylc
# flow.cylc
R1 = "a => b"  # trigger a, then trigger b if a succeeds
```

Task `a` runs the application `bin/a.sh`, whose output path is configured
by a command line option.

Task `b` runs the application `bin/b.sh`, whose I/O paths are configured by
environment variables.

The workflow defines a shared file path (to be written to task job scripts)
and configures `a` to use it for output, and `b` to use it as input.

**NOTE:** there are no Cylc config items for these input and output paths. They
are communicated to jobs via (in this case) environment variables and command
lines as required by the applications being run. Thus, *at runtime only the
task jobs "know" these locations, the Cylc scheduler does not.* If you get
them wrong the workflow will stall because the tasks will fail as a result,
not because (say) "Cylc can't find the files".

### Running the example

```console
# Go to the workflow source directory
$ cd cylc-src/one

# validate, install, and play the workflow
$ cylc vip --no-detach .
...
```

### Viewing the output

```console
# view the shared workspace for the run
$ tree ~/cylc-run/one/runN/share
/home/oliverh/cylc-run/one/runN/share
├── idata
└── result

# view task b's job.out log
$ cylc cat-log one//1/b
Workflow : one/run6
Job : 1/b/01 (try 1)
User@Host: oliverh@NIWA-1022450
Processing data
  from "/home/oliverh/cylc-run/one/run6/share/idata"
  to "/home/oliverh/cylc-run/one/run6/share/result"
Done
2025-03-20T02:17:25Z INFO - started
2025-03-20T02:17:25Z INFO - succeeded

# inspect the job log directory
$ tree ~/cylc-run/one/runN/log/job
/home/oliverh/cylc-run/one/runN/log/job
└── 1
    ├── a
    │   ├── 01
    │   │   ├── job
    │   │   ├── job-activity.log
    │   │   ├── job.err
    │   │   ├── job.out
    │   │   └── job.status
    │   └── NN -> 01
    └── b
        ├── 01
        │   ├── job
        │   ├── job-activity.log
        │   ├── job.err
        │   ├── job.out
        │   └── job.status
        └── NN -> 01

```
